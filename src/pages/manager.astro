---
import Layout from '../layouts/Layout.astro';
---

<Layout title="–ú–µ–Ω–µ–¥–∂–µ—Ä - –ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è">
	<div class="min-h-screen bg-base-200">
		<!-- Header with Drawer -->
		<div class="drawer lg:drawer-open">
			<input id="drawer-toggle" type="checkbox" class="drawer-toggle" />

			<div class="drawer-content flex flex-col">
				<!-- Navbar -->
				<div class="navbar bg-primary text-primary-content sticky top-0 z-50 shadow-lg">
					<div class="flex-none lg:hidden">
						<label for="drawer-toggle" class="btn btn-square btn-ghost">
							<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" class="inline-block w-6 h-6 stroke-current">
								<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
							</svg>
						</label>
					</div>
					<div class="flex-1">
						<span class="text-2xl mr-2">üëî</span>
						<span class="text-xl font-bold">–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
					</div>
					<div class="flex-none">
						<a href="/" class="btn btn-ghost btn-sm">
							‚Üê –ù–∞–∑–∞–¥
						</a>
					</div>
				</div>

				<!-- Main Content -->
				<main class="flex-1 p-4">
					<div class="max-w-7xl mx-auto">
						<!-- Tabs -->
						<div role="tablist" class="tabs tabs-boxed bg-base-100 mb-6 flex-wrap gap-2">
							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="üìã –ó–∞–∫–∞–∑—ã" checked />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<h3 class="text-2xl font-bold mb-4">üìã –ó–∞–∫–∞–∑—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
								<div id="ordersByCategory">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –∑–∞–∫–∞–∑–æ–≤...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<div class="flex justify-between items-center mb-4">
									<h3 class="text-2xl font-bold">‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã</h3>
									<button onclick="exportAllDeliveredOrders()" class="btn btn-success btn-sm">
										üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
									</button>
								</div>
								<div id="deliveredOrders">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<div class="flex justify-between items-center mb-4">
									<h3 class="text-2xl font-bold">üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</h3>
									<button onclick="addNewCategory()" class="btn btn-success btn-sm">
										‚ûï –ö–∞—Ç–µ–≥–æ—Ä–∏—è
									</button>
								</div>
								<div id="categorySuppliers">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–π...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="üè¢ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<div class="flex justify-between items-center mb-4">
									<h3 class="text-2xl font-bold">üè¢ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</h3>
									<button onclick="addNewSupplier()" class="btn btn-primary btn-sm">
										‚ûï –î–æ–±–∞–≤–∏—Ç—å
									</button>
								</div>
								<div id="suppliersList">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–∞–≤—â–∏–∫–æ–≤...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="üè™ –û—Ç–¥–µ–ª—ã" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<div class="flex justify-between items-center mb-4">
									<h3 class="text-2xl font-bold">üè™ –û—Ç–¥–µ–ª—ã</h3>
									<div class="flex gap-2">
										<button onclick="syncDepartmentsFromPoster()" class="btn btn-info btn-sm">
											üîÑ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è
										</button>
										<button onclick="addNewDepartment()" class="btn btn-success btn-sm">
											‚ûï –î–æ–±–∞–≤–∏—Ç—å
										</button>
									</div>
								</div>
								<div id="departmentsList">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç–¥–µ–ª–æ–≤...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="üì¶ –¢–æ–≤–∞—Ä—ã" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<div class="flex justify-between items-center mb-4">
									<h3 class="text-2xl font-bold">üì¶ –¢–æ–≤–∞—Ä—ã</h3>
									<button onclick="openAddProductModal()" class="btn btn-success btn-sm">
										‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä
									</button>
								</div>
								<div id="productsList">
									<div class="text-center text-gray-500 py-12">
										<span class="loading loading-spinner loading-lg"></span>
										<p class="mt-4">–ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤...</p>
									</div>
								</div>
							</div>

							<input type="radio" name="manager_tabs" role="tab" class="tab" aria-label="‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏" />
							<div role="tabpanel" class="tab-content bg-base-100 border-base-300 rounded-box p-6">
								<h3 class="text-2xl font-bold mb-4">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</h3>
								<div class="space-y-4">
									<div class="card bg-base-100 shadow-xl">
										<div class="card-body">
											<h2 class="card-title">–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Poster</h2>
											<p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Poster POS —Å–∏—Å—Ç–µ–º–µ</p>
											<div class="card-actions justify-end">
												<button class="btn btn-primary btn-sm">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
											</div>
										</div>
									</div>
									<div class="card bg-base-100 shadow-xl">
										<div class="card-body">
											<h2 class="card-title">–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è</h2>
											<p>–ù–∞—Å—Ç—Ä–æ–π—Ç–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞–∫–∞–∑–∞—Ö</p>
											<div class="card-actions justify-end">
												<button class="btn btn-primary btn-sm">–ù–∞—Å—Ç—Ä–æ–∏—Ç—å</button>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</main>
			</div>

			<!-- Drawer Sidebar (Mobile) -->
			<div class="drawer-side lg:hidden">
				<label for="drawer-toggle" aria-label="close sidebar" class="drawer-overlay"></label>
				<ul class="menu p-4 w-80 min-h-full bg-base-100 text-base-content">
					<li class="menu-title">
						<span class="text-lg font-bold">–ú–µ–Ω–µ–¥–∂–µ—Ä</span>
					</li>
					<li><a>üìã –ó–∞–∫–∞–∑—ã</a></li>
					<li><a>‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ</a></li>
					<li><a>üè∑Ô∏è –ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a></li>
					<li><a>üè¢ –ü–æ—Å—Ç–∞–≤—â–∏–∫–∏</a></li>
					<li><a>üè™ –û—Ç–¥–µ–ª—ã</a></li>
					<li><a>üì¶ –¢–æ–≤–∞—Ä—ã</a></li>
					<li><a>‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</a></li>
					<div class="divider"></div>
					<li><a href="/">üè† –ù–∞ –≥–ª–∞–≤–Ω—É—é</a></li>
				</ul>
			</div>
		</div>
	</div>

	<script is:inline>
		// Load orders by category
		async function loadOrdersByCategory() {
			console.log('üìã Loading orders by category...');
			try {
				const response = await fetch('/api/orders-by-category');
				const data = await response.json();

				if (data.success) {
					displayOrdersByCategory(data.data);
				} else {
					console.error('‚ùå Failed to load orders:', data.error);
					displayOrdersByCategory([]);
				}
			} catch (error) {
				console.error('‚ùå Error loading orders:', error);
				displayOrdersByCategory([]);
			}
		}

		// Display orders as DaisyUI cards
		function displayOrdersByCategory(orders) {
			const container = document.getElementById('ordersByCategory');
			if (!container) return;

			if (!orders || orders.length === 0) {
				container.innerHTML = `
					<div class="text-center py-12">
						<div class="text-6xl mb-4">üìã</div>
						<p class="text-xl font-semibold mb-2">–ù–µ—Ç –∑–∞–∫–∞–∑–æ–≤</p>
						<p class="text-gray-500">–ó–∞–∫–∞–∑—ã –ø–æ—è–≤—è—Ç—Å—è –∑–¥–µ—Å—å –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è</p>
					</div>
				`;
				return;
			}

			let html = '<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">';

			orders.forEach((order) => {
				const statusBadge = order.status === 'pending' ? 'badge-warning' :
								   order.status === 'sent' ? 'badge-info' : 'badge-success';
				const statusText = order.status === 'pending' ? '–û–∂–∏–¥–∞–µ—Ç' :
								  order.status === 'sent' ? '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω' : '–î–æ—Å—Ç–∞–≤–ª–µ–Ω';

				html += `
					<div class="card bg-base-100 shadow-xl hover:shadow-2xl transition-shadow">
						<div class="card-body">
							<div class="flex justify-between items-start mb-2">
								<span class="badge badge-lg">${order.departmentEmoji} ${order.departmentName}</span>
								<span class="badge ${statusBadge}">${statusText}</span>
							</div>
							<h2 class="card-title">–ó–∞–∫–∞–∑ #${order.orderId}</h2>
							<p class="text-sm opacity-70">${order.displayDate}</p>
							<div class="divider my-2"></div>
							<div class="stats stats-vertical shadow">
								<div class="stat py-2 px-4">
									<div class="stat-title text-xs">–¢–æ–≤–∞—Ä–æ–≤</div>
									<div class="stat-value text-2xl">${order.totalItems}</div>
								</div>
								<div class="stat py-2 px-4">
									<div class="stat-title text-xs">–ï–¥–∏–Ω–∏—Ü</div>
									<div class="stat-value text-2xl">${order.totalQuantity}</div>
								</div>
							</div>
							<div class="card-actions justify-end mt-4">
								<button class="btn btn-primary btn-sm">–î–µ—Ç–∞–ª–∏</button>
							</div>
						</div>
					</div>
				`;
			});

			html += '</div>';
			container.innerHTML = html;
		}

		function exportAllDeliveredOrders() {
			alert('–≠–∫—Å–ø–æ—Ä—Ç –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
		}

		function addNewCategory() {
			alert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
		}

		function addNewSupplier() {
			alert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
		}

		async function syncDepartmentsFromPoster() {
			try {
				const response = await fetch('/api/sync-departments-from-poster');
				const result = await response.json();
				alert(result.success ? '‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞!' : '‚ùå –û—à–∏–±–∫–∞: ' + result.error);
			} catch (error) {
				alert('‚ùå –û—à–∏–±–∫–∞: ' + error.message);
			}
		}

		function addNewDepartment() {
			alert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–¥–µ–ª–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
		}

		function openAddProductModal() {
			alert('–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ');
		}

		// Load data
		document.addEventListener('DOMContentLoaded', () => {
			console.log('üì± Manager page loaded with DaisyUI');
			loadOrdersByCategory();
			setInterval(loadOrdersByCategory, 30000);
		});
	</script>
</Layout>
