---
import Layout from '../layouts/Layout.astro';
import { getTenantConfig } from '../lib/tenant.js';

// Get tenant info
const tenantId = Astro.locals.tenantId || 'default';
const tenantConfig = getTenantConfig(tenantId);
---

<Layout title="Restaurant Checklist - Inventory Management">
	<div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
		<!-- Header with Role Info -->
		<header class="bg-white shadow-sm border-b border-gray-200">
			<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
				<div class="flex justify-between items-center py-4">
					<h1 class="text-2xl font-bold text-gray-900">{tenantConfig.logo} {tenantConfig.name}</h1>
					<div id="userInfo" class="flex items-center space-x-4">
						<!-- Will be populated by JavaScript -->
					</div>
				</div>
			</div>
		</header>

		<main class="max-w-4xl mx-auto p-6">
			<!-- Role-based Welcome Message -->
			<div id="welcomeSection" class="text-center mb-8">
				<h2 id="welcomeTitle" class="text-3xl font-bold text-gray-800 mb-4">Welcome!</h2>
				<p id="welcomeMessage" class="text-lg text-gray-600">Please select your role to continue</p>
			</div>

			<!-- Department Selection (Role-based visibility) -->
			<div id="departmentGrid" class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
				<!-- Kitchen Department -->
				<div id="kitchenCard" class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
					<div class="bg-gradient-to-r from-orange-400 to-red-500 p-6">
						<div class="flex items-center justify-between">
							<div>
								<h3 class="text-xl font-bold text-white">–ö—É—Ö–Ω—è</h3>
								<p class="text-orange-100">Kitchen Inventory</p>
							</div>
							<span class="text-4xl">üç≥</span>
						</div>
					</div>
					<div class="p-6">
						<p class="text-gray-600 mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞–º–∏ –∫—É—Ö–Ω–∏ –∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –ø—Ä–æ–¥—É–∫—Ç–æ–≤</p>
						<a href="/kitchen" class="inline-flex items-center px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors">
							<span class="mr-2">üìã</span>
							–û—Ç–∫—Ä—ã—Ç—å –∫—É—Ö–Ω—é
						</a>
					</div>
				</div>

				<!-- Bar Department -->
				<div id="barCard" class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
					<div class="bg-gradient-to-r from-purple-400 to-pink-500 p-6">
						<div class="flex items-center justify-between">
							<div>
								<h3 class="text-xl font-bold text-white">–ë–∞—Ä</h3>
								<p class="text-purple-100">Bar Inventory</p>
							</div>
							<span class="text-4xl">üç∑</span>
						</div>
					</div>
					<div class="p-6">
						<p class="text-gray-600 mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∞—Å–∞–º–∏ –±–∞—Ä–∞ –∏ –∞–ª–∫–æ–≥–æ–ª—å–Ω—ã–º–∏ –Ω–∞–ø–∏—Ç–∫–∞–º–∏</p>
						<a href="/bar-inventory" class="inline-flex items-center px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">
							<span class="mr-2">üç∏</span>
							–û—Ç–∫—Ä—ã—Ç—å –±–∞—Ä
						</a>
					</div>
				</div>

				<!-- Housekeeping Department -->
				<div id="housekeepingCard" class="bg-white rounded-xl shadow-lg overflow-hidden hover:shadow-xl transition-shadow duration-300">
					<div class="bg-gradient-to-r from-green-400 to-blue-500 p-6">
						<div class="flex items-center justify-between">
							<div>
								<h3 class="text-xl font-bold text-white">–ì–æ—Ä–Ω–∏—á–Ω–∞—è</h3>
								<p class="text-green-100">Housekeeping</p>
							</div>
							<span class="text-4xl">üßπ</span>
						</div>
					</div>
					<div class="p-6">
						<p class="text-gray-600 mb-4">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ö–æ–∑—è–π—Å—Ç–≤–µ–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞–º–∏ –∏ –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—è–º–∏</p>
						<a href="/housekeeping" class="inline-flex items-center px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
							<span class="mr-2">üßΩ</span>
							–û—Ç–∫—Ä—ã—Ç—å —Ö–æ–∑—è–π—Å—Ç–≤–æ
						</a>
					</div>
				</div>
			</div>

			<!-- Manager/Admin Section -->
			<div id="managerSection" class="bg-white rounded-xl shadow-lg p-6 mb-8" style="display: none;">
				<h3 class="text-xl font-bold text-gray-800 mb-4">üë®‚Äçüíº Manager Tools</h3>
				<div class="grid grid-cols-1 md:grid-cols-3 gap-4">
					<a href="/manager-dashboard" class="bg-blue-600 hover:bg-blue-700 text-white p-4 rounded-lg transition-colors">
						<div class="flex items-center">
							<span class="text-2xl mr-3">üìä</span>
							<div>
								<h4 class="font-semibold">Dashboard</h4>
								<p class="text-sm opacity-90">Pending orders</p>
							</div>
						</div>
					</a>
					<a href="/settings" class="bg-gray-600 hover:bg-gray-700 text-white p-4 rounded-lg transition-colors">
						<div class="flex items-center">
							<span class="text-2xl mr-3">‚öôÔ∏è</span>
							<div>
								<h4 class="font-semibold">Settings</h4>
								<p class="text-sm opacity-90">Suppliers</p>
							</div>
						</div>
					</a>
					<a href="/cart" class="bg-green-600 hover:bg-green-700 text-white p-4 rounded-lg transition-colors">
						<div class="flex items-center">
							<span class="text-2xl mr-3">üõí</span>
							<div>
								<h4 class="font-semibold">Cart</h4>
								<p class="text-sm opacity-90">Review orders</p>
							</div>
						</div>
					</a>
				</div>
			</div>

			<!-- Quick Actions -->
			<div class="text-center">
				<div class="flex flex-col sm:flex-row gap-4 justify-center">
					<a href="/cart" class="inline-flex items-center px-6 py-3 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors">
						<span class="mr-2">üõí</span>
						–ö–æ—Ä–∑–∏–Ω–∞ –∑–∞–∫–∞–∑–æ–≤
					</a>
					<a href="/delivery" class="inline-flex items-center px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors">
						<span class="mr-2">üöö</span>
						–°—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏
					</a>
				</div>
			</div>
		</main>
	</div>

	<script is:inline>
		document.addEventListener('DOMContentLoaded', () => {
			checkUserRoleAndAdjustUI();
		});

		function checkUserRoleAndAdjustUI() {
			const userRole = localStorage.getItem('userRole');
			const userRoleTimestamp = localStorage.getItem('userRoleTimestamp');

			// Check if role has expired (8 hours)
			if (userRole && userRoleTimestamp) {
				const eightHours = 8 * 60 * 60 * 1000;
				if (Date.now() - parseInt(userRoleTimestamp) > eightHours) {
					localStorage.removeItem('userRole');
					localStorage.removeItem('userRoleTimestamp');
					window.location.href = '/login';
					return;
				}
			}

			if (!userRole) {
				// No role selected, redirect to login
				window.location.href = '/login';
				return;
			}

			// Update UI based on role
			updateUIForRole(userRole);
		}

		function updateUIForRole(role) {
			const roleNames = {
				chef: '–ü–æ–≤–∞—Ä üë®‚Äçüç≥',
				barman: '–ë–∞—Ä–º–µ–Ω üç∑',
				manager: '–ú–µ–Ω–µ–¥–∂–µ—Ä üë®‚Äçüíº',
				admin: '–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä ‚öôÔ∏è'
			};

			const welcomeMessages = {
				chef: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫—É—Ö–Ω–µ–π',
				barman: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞—Ä–æ–º',
				manager: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –ø–∞–Ω–µ–ª—å –º–µ–Ω–µ–¥–∂–µ—Ä–∞',
				admin: '–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—É—é –ø–∞–Ω–µ–ª—å'
			};

			// Update welcome section
			document.getElementById('welcomeTitle').textContent = `–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${roleNames[role]}!`;
			document.getElementById('welcomeMessage').textContent = welcomeMessages[role];

			// Update user info in header
			document.getElementById('userInfo').innerHTML = `
				<span class="text-sm text-gray-600">${roleNames[role]}</span>
				<button onclick="logout()" class="text-sm text-red-600 hover:text-red-800">–í—ã–π—Ç–∏</button>
			`;

			// Show/hide sections based on role
			if (role === 'chef') {
				// Chef can only see kitchen
				document.getElementById('barCard').style.display = 'none';
				document.getElementById('housekeepingCard').style.display = 'none';
			} else if (role === 'barman') {
				// Barman can only see bar
				document.getElementById('kitchenCard').style.display = 'none';
				document.getElementById('housekeepingCard').style.display = 'none';
			} else if (role === 'manager' || role === 'admin') {
				// Manager/Admin can see everything + manager tools
				document.getElementById('managerSection').style.display = 'block';
			}
		}

		function logout() {
			localStorage.removeItem('userRole');
			localStorage.removeItem('userRoleTimestamp');
			window.location.href = '/login';
		}

		// Make logout globally accessible
		window.logout = logout;
	</script>
</Layout>
